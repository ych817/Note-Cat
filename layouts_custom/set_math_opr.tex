\makeatletter
% ----- 运算符注册模板
\def\RegistOpr#1Type{
   \@ifnextchar A%
  {\RegistOpr@TypeA@{#1}} % 发现 A，交给 TypeA 处理
  {\@ifnextchar B%
  {\RegistOpr@TypeB@{#1}} % 发现 B，交给 TypeB 处理
  {\@ifnextchar C%
  {\RegistOpr@TypeC@{#1}} % 发现 C，交给 TypeC 处理
  {\@ifnextchar D%
  {\RegistOpr@TypeD@{#1}} % 发现 D，交给 TypeD 处理
  {\relax}}}}
}
\def\RegistOpr@TypeA@#1A{
  \@ifnextchar [%
  {\RegistOpr@TypeA@opt{#1}}
  {\RegistOpr@TypeA@opt{#1}[]}
}
\def\RegistOpr@TypeB@#1B{
  \@ifnextchar [%
  {\RegistOpr@TypeB@opt{#1}}
  {\RegistOpr@TypeB@opt{#1}[]}
}
\def\RegistOpr@TypeC@#1C{
  \@ifnextchar [%
  {\RegistOpr@TypeC@opt{#1}}
  {\RegistOpr@TypeC@opt{#1}[]}
}
\def\RegistOpr@TypeD@#1D{
  \@ifnextchar [%
  {\RegistOpr@TypeD@opt{#1}}
  {\RegistOpr@TypeD@opt{#1}[]}
}
\def\RegistOpr@TypeA@opt#1[#2]{
  \ExpandArgs{c}\def{opr#1defaultType}{}
  \ExpandArgs{c}\def{opr#1display}{}
  \pgfkeys{
    /opr/typeA/#1/.is family, /opr/typeA/#1,
    default type/.store in/.expand once = \csname opr#1defaultType\endcsname,
    display as/.store in/.expand once = \csname opr#1display\endcsname,
    #2
  }
  \ExpandArgs{c}\DeclareDocumentCommand{#1}{%
    +O{\UseName{opr#1defaultType}}%
  }{%
    \plr{\ensuremath{%
      \stackunder[0pt]{\stackon[0pt]{\plr{\csname opr#1display\endcsname}}
      {}}
      {\text{\scriptsize\(\plr{##1}\)}}
    }}
  }
}
\def\RegistOpr@TypeB@opt#1[#2]{%
  \ExpandArgs{c}\def{opr#1defaultType}{}
  \pgfkeys{
    /opr/typeB/#1/.is family, /opr/typeB/#1,
    default type/.store in/.expand once = \csname opr#1defaultType\endcsname,
    #2
  }
  \ExpandArgs{c}\DeclareDocumentCommand{#1}{%
    +O{\UseName{opr#1defaultType}}%
  }{%
    \plr{\ensuremath{%
      \xrightarrow[\text{\scriptsize\(\plr{##1}\)}]{}%
    }}
  }
}
\def\RegistOpr@TypeC@opt#1[#2]{
  \ExpandArgs{c}\def{opr#1defaultType}{}
  \ExpandArgs{c}\def{opr#1defaultIndx}{}
  \ExpandArgs{c}\def{opr#1display}{}
  \pgfkeys{
    /opr/typeC/#1/.is family, /opr/typeC/#1,
    default type/.store in/.expand once = \csname opr#1defaultType\endcsname,
    default index/.store in/.expand once = \csname opr#1defaultIndx\endcsname,
    display as/.store in/.expand once = \csname opr#1display\endcsname,
    #2
  }
  \ExpandArgs{c}\DeclareDocumentCommand{#1}{%
    +O{\UseName{opr#1defaultType}}   
    D(){\UseName{opr#1defaultIndx}} 
  }{\plr{\ensuremath{%
    \stackunder[0pt]{\stackon[0pt]{\plr{\UseName{opr#1display}}}
    {}}
    {\text{\scriptsize\(\plr{##1~##2}\)}}}}
  }
}
\def\RegistOpr@TypeD@opt#1[#2]{
  \ExpandArgs{c}\def{opr#1defaultType}{}
  \ExpandArgs{c}\def{opr#1display}{}
  \pgfkeys{
    /opr/typeD/#1/.is family, /opr/typeD/#1,
    default type/.store in/.expand once = \csname opr#1defaultType\endcsname,
    display as/.store in/.expand once = \csname opr#1display\endcsname,
    #2
  }
  \ExpandArgs{c}\DeclareDocumentCommand{#1}{
    +O{\UseName{opr#1defaultType}}
  }{%
    \plr{\ensuremath{%
      {}_{\scriptscriptstyle\plr{:##1}}^{}{\csname opr#1display\endcsname}
    }}
  }
}
\makeatother