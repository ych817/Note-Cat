% ---- 启用数学堆叠
\stackMath
% ---- 常用简写
\let\xpndaft=\expandafter
\let\ncm=\newcommand
\let\rcm=\renewcommand
% ----- 排版相关
\newcommand{\cfbox}[2][blue]{%
  \setlength{\fboxsep}{0pt}%
  \setlength{\fboxrule}{0.4pt}%
  \colorlet{currentcolor}{.}%
  {\color{#1}%
  \fbox{\color{currentcolor}\ensuremath{#2}}}%
}
\def\mathpalette#1#2{\ifcase\mathstyle
  #1\displaystyle{#2}\or
  #1\displaystyle{#2}\or
  #1\textstyle{#2}\or
  #1\textstyle{#2}\or
  #1\scriptstyle{#2}\or
  #1\scriptstyle{#2}\or
  #1\scriptscriptstyle{#2}\or
  #1\scriptscriptstyle{#2}\fi
}
\let\ph=\phantom
\let\hph=\hphantom
\let\vph=\vphantom
\let\mrel=\mathrel
\let\mbin=\mathbin
\let\mop=\mathop
\let\mllap=\mathllap                 % 根据文本右侧对齐
\let\mrlap=\mathrlap                 % 根据文本左侧对齐
\let\mclap=\mathclap                 % 根据文本中央对齐
\def\vts#1{\lvert#1\rvert}
\def\prs#1{\left(#1\right)}
\def\bcs#1{\left\{#1\right\}}
\def\bks#1{\left[#1\right]}
% \def\plr#1{#1}
\def\plr#1{\vph{(fg)}\smash{#1}}     % 柱子
\def\etc{\plr{\rm etc}}              % 省略号
\def\occ{\plr{\texttt{\_}}}          % 占位符
% ----- 变量注册模板 带高亮
\makeatletter
\def\RegistVarType#1{
  \@ifnextchar [%
  {\RegistVarType@opt{#1}}
  {\RegistVarType@opt{#1}[]}
}
\def\RegistVarType@opt#1[#2]{
  \xpndaft\def\csname var#1colorBG\endcsname{}
  \xpndaft\def\csname var#1font\endcsname{}
  \pgfkeys{%
    /var/#1/.is family, /var/#1,
    colorBG/.store in/.expand once = \csname var#1colorBG\endcsname,
    font/.store in/.expand once = \csname var#1font\endcsname,
    #2
  }
  \xpndaft\def\csname var#1\endcsname##1{%
    \setlength{\fboxsep}{0pt}%
    \setlength{\fboxrule}{0pt}%
    \let\RegistVar@Cache=\relax  
    \xpndaft\ifx\csname var#1colorBG\endcsname\empty
      \def\RegistVar@Cache{\fbox}%
    \else
      \def\RegistVar@Cache{\colorbox{\csname var#1colorBG\endcsname}}%
    \fi
    \RegistVar@Cache{\ensuremath{\plr{\csname var#1font\endcsname ##1}}}%
  }
}
% ------ 常用变量注册模板 带高亮
\def\RegistVarFamily#1Type#2{
  \@ifnextchar [%
  {\RegistVarFamily@{#1}{#2}}
  {\RegistVarFamily@{#1}{#2}[]}
}
\def\RegistVarFamily@#1#2[#3]{%
  \expandafter\def\csname var#2#1display\endcsname{#1}%
  \expandafter\def\csname var#2#1primes\endcsname{0}%
  \pgfkeys{
    /var/#2/.is family, /var/#2,
    display as/.store in/.expand once = \csname var#2#1display\endcsname,
    prime number/.store in/.expand once = \csname var#2#1primes\endcsname,
    #3
  }
  \RegistVarFamilyLoop{#1}{#2}
    {\csname var#2#1display\endcsname}
    {\csname var#2#1primes\endcsname}
}
\ExplSyntaxOn
\cs_new_protected:Npn \RegistVarFamilyLoop #1 #2 #3 #4 {
  \int_step_inline:nnnn { 0 } { 1 } { #4 }{
    \str_clear:N \l_tmpa_str
    \prg_replicate:nn { ##1 } { \str_put_right:Nn \l_tmpa_str {p} }
    \tl_clear:N \l_tmpb_tl
    \prg_replicate:nn { ##1 } { \tl_put_right:Nn \l_tmpb_tl {'} }
    \cs_set_protected:cpx { #2 #1 \l_tmpa_str } {
      \exp_not:c { var #2 } { 
        { \exp_not:n { #3 } } \exp_not:V \l_tmpb_tl 
      }
    }
    \cs_set_protected:cpx { #2 #1 \l_tmpa_str n } ####1{
      \exp_not:c { var #2 } { 
        { \exp_not:n { #3 } } \exp_not:V \l_tmpb_tl \sb{####1} 
      }
    }
  }
}
\ExplSyntaxOff
\makeatother