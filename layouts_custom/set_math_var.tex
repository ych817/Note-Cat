% ---- 启用数学堆叠
\stackMath
% ---- 常用简写
\let\xpndaft=\expandafter
\let\ncm=\newcommand
\let\rcm=\renewcommand
% ----- 排版相关
\newcommand{\cfbox}[2][blue]{%
  \setlength{\fboxsep}{0pt}%
  \setlength{\fboxrule}{0.4pt}%
  \colorlet{currentcolor}{.}%
  {\color{#1}%
  \fbox{\color{currentcolor}\ensuremath{#2}}}%
}
\let\ph=\phantom
\let\hph=\hphantom
\let\vph=\vphantom
\let\mrel=\mathrel
\let\mbin=\mathbin
\let\mop=\mathop
\let\mllap=\mathllap                 % 根据文本右侧对齐
\let\mrlap=\mathrlap                 % 根据文本左侧对齐
\let\mclap=\mathclap                 % 根据文本中央对齐
\def\vts#1{\lvert#1\rvert}
\def\prs#1{\left(#1\right)}
\def\bcs#1{\left\{#1\right\}}
\def\bks#1{\left[#1\right]}
\def\plr#1{\vph{(fg)}\smash{#1}}     % 柱子
\def\etc{\plr{\rm etc}}              % 省略号
\def\occ{\plr{\texttt{\_}}}          % 占位符
% ----- 变量注册模板 带高亮
% \def\gobble#1{}                      % 吞掉参数
\makeatletter
\def\RegistVarType#1{
  \@ifnextchar [%
  {\RegistVarType@{#1}}
  {\RegistVarType@{#1}[]}
}
\def\RegistVarType@#1[#2]{
  \xpndaft\def\csname var#1colorBG\endcsname{}
  \xpndaft\def\csname var#1font\endcsname{}
  \pgfkeys{%
    /var #1/.is family, /var #1,
    colorBG/.store in/.expand once = \csname var#1colorBG\endcsname,
    font/.store in/.expand once = \csname var#1font\endcsname,
    #2
  }
  \xpndaft\def\csname var#1\endcsname##1{%
    \setlength{\fboxsep}{0pt}%
    \setlength{\fboxrule}{0pt}%
    \let\RegistVar@Cache=\relax  
    \xpndaft\ifx\csname var#1colorBG\endcsname\empty
      \def\RegistVar@Cache{\fbox}%
    \else
      \def\RegistVar@Cache{\colorbox{\csname var#1colorBG\endcsname}}%
    \fi
    \RegistVar@Cache{\ensuremath{\plr{\csname var#1font\endcsname ##1}}}%
  }
}
% ------ 常用变量注册模板 带高亮
\def\RegistVarFamily#1Type#2{
  \@ifnextchar D%
  {\RegistVarFamily@{#1}{#2}}
  {\RegistVarFamily@{#1}{#2}Disp{#1}}
}
\def\RegistVarFamily@#1#2Disp#3{%
  \xpndaft\def\csname #2#1\endcsname{%
    \csname var#2\endcsname{{#3}^{}}%
  }
  \xpndaft\def\csname #2#1n\endcsname##1{%
    \csname var#2\endcsname{{#3}_{##1}^{}}%
  }
  \@ifnextchar p
  {\RegistVarFamily@Loop{#1}{#2}{p}{'}{#3}}
  {\relax}
}
\def\RegistVarFamily@Loop#1#2#3#4#5p{% 
  \xpndaft\def\csname #2#1#3\endcsname{%
    \csname var#2\endcsname{{#5}#4}%
  }
  \xpndaft\def\csname #2#1#3n\endcsname##1{%
    \csname var#2\endcsname{{#5}#4_{##1}}%
  } 
  \@ifnextchar p
  {\RegistVarFamily@Loop{#1}{#2}{#3p}{#4'}{#5}} 
  {\relax}   
}
\makeatother